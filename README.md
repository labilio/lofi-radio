# Lofi Radio Widget (桌面小部件音乐播放器)

一个基于 Electron 的桌面小部件音乐播放器，具有毛玻璃效果的精美UI，可以播放 Bilibili 直播间的 Lofi 音乐。

## 功能特点

- 🎨 **桌面小部件**：精美的毛玻璃效果界面，悬浮在桌面上
- 🎵 **黑胶唱片动画**：播放时唱片旋转，视觉效果出色
- 🎶 **Bilibili 直播源**：播放指定的 Bilibili 直播间音乐
- ⌨️ **老板键**：按 `Alt+Q` 快速切换播放/暂停
- 🔔 **系统托盘**：右下角托盘图标，右键菜单控制
- 🔊 **音量控制**：实时调节播放音量
- 🖱️ **可拖拽界面**：无标题栏设计，支持整窗拖拽
- ❌ **一键关闭**：右上角小叉叉快速退出

## 安装步骤

### 1. 安装 Node.js

首先需要安装 Node.js（包含 npm）：

1. 访问 [Node.js 官网](https://nodejs.org/)
2. 下载 LTS 版本的安装包
3. 按照提示安装

安装完成后，在命令行中验证：
```bash
node --version
npm --version
```

### 2. 安装项目依赖

```bash
npm install
```

### 3. 运行应用

**推荐方式（Windows）：**
```bash
run.bat
```

这个脚本会：
- 检查系统要求
- 显示详细的启动信息
- 将小部件窗口显示在屏幕中央
- 提供使用说明

**或者手动运行：**
```bash
npm start
```

**其他选项：**
```bash
# 系统诊断
check.ps1

# 简单测试
test.bat

# 开发模式
npm run dev

# 调试模式（更多日志信息）
npm run debug
```

## 使用方法

1. **启动应用**：运行 `run.bat` 后，小部件会显示在屏幕中央
2. **界面操作**：
   - **拖拽移动**：点击任意空白区域拖拽小部件到任意位置
   - **静音控制**：点击中间的播放/静音按钮（系统级静音）
   - **音量调节**：拖拽右下角的音量滑块（0-100%）
   - **关闭应用**：点击右上角的 × 按钮
3. **快捷键控制**：
   - 按 `Alt+Q` 键切换静音/取消静音
   - 右键点击托盘图标也可以控制
4. **退出应用**：点击关闭按钮或右键托盘图标 → 退出

## 核心特性

- **系统级静音控制**：使用Electron的`setAudioMuted()`API，100%可靠
- **深色毛玻璃主题**：在任何背景下都有良好可见性
- **智能拖拽**：按钮区域不可拖拽，其他区域均可拖拽
- **轮询初始化**：使用`setInterval`确保B站视频加载后再取消静音

## 文件说明

- `package.json` - 项目配置和依赖
- `main.js` - Electron 主进程文件，管理窗口和IPC通信
- `preload.js` - 预加载脚本，提供安全的IPC接口
- `index.html` - 桌面小部件的HTML界面
- `styles.css` - 毛玻璃效果和动画样式
- `widget.js` - 前端交互逻辑
- `run.bat` - Windows快速启动脚本

## 技术实现

- **Electron**：跨平台桌面应用框架
- **BrowserWindow**：创建隐形浏览器窗口
- **Tray**：系统托盘图标
- **globalShortcut**：全局快捷键注册
- **JavaScript 注入**：动态控制网页视频播放

## 注意事项

- 应用启动后会在后台加载 Bilibili 直播页面
- 由于浏览器安全限制，可能需要手动允许自动播放
- 如果播放失败，可以尝试刷新页面或重新启动应用

## 界面特性

- **毛玻璃效果**：使用 `backdrop-filter: blur()` 实现现代化的半透明效果
- **圆角设计**：15px圆角，营造柔和的视觉感受
- **黑胶唱片动画**：播放时唱片顺时针旋转，暂停时停止
- **响应式布局**：适配不同尺寸的窗口
- **无边框设计**：完全自定义的窗口外观

## 技术实现

- **双窗口架构**：一个隐藏的音频窗口 + 一个UI小部件窗口
- **IPC通信**：安全的进程间通信控制音频播放
- **CSS动画**：流畅的黑胶唱片旋转效果
- **拖拽支持**：`-webkit-app-region` 实现窗口拖拽

## 故障排除

1. **点击 run.bat 后什么都没有发生**：
   - 应用实际上已经启动，但窗口可能在屏幕中央
   - 按 `Alt+Tab` 切换窗口查找应用
   - 检查任务管理器中是否有 "electron" 进程
   - 运行 `check.ps1` 进行系统诊断

2. **看不到桌面小部件**：
   - 窗口显示在屏幕中央（不是右下角）
   - 可能是透明背景，看起来不明显
   - 尝试点击屏幕中央区域
   - 按 `Win+D` 显示桌面，然后再切换回来

3. **应用启动失败**：
   - 确保 Node.js 和 npm 已正确安装
   - 尝试删除 `node_modules` 文件夹并重新运行 `npm install`
   - 使用 `npm run debug` 查看详细错误信息

4. **毛玻璃效果不显示**：
   - 某些 Windows 版本可能不支持 `backdrop-filter`
   - 会自动降级为普通半透明背景

5. **无法播放音频**：
   - 检查网络连接，确保能访问 Bilibili
   - 等待5秒让音频完全加载（会有状态提示）
   - 小部件底部会显示加载状态

6. **快捷键无效**：
   - 确认 `Alt+Q` 没有被其他应用占用
   - 检查应用是否正在运行（查看任务管理器）

7. **托盘图标不显示**：
   - Windows 某些版本可能不支持
   - 应用仍会正常工作，只是没有托盘图标

8. **Windows 特定问题**：
   - 右键点击 `run.bat` 文件，选择"以管理员身份运行"
   - 确保 Windows Defender 没有阻止应用

## 自定义配置

可以修改 `main.js` 中的以下配置：
- 直播间地址
- 快捷键组合
- 托盘菜单选项
- 窗口大小和行为